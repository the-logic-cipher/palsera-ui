"use strict";angular.module("app",["ngAnimate","ngStorage","ui.router","ui.bootstrap","ui.utils","ui.load","ui.jq","ui.gravatar","oc.lazyLoad","toaster","checklist-model","restangular","app.utilities","app.localService","app.accessService","app.authService","app.dashboard","app.access","app.school","app.users","app.shipment"]).run(["$rootScope","$location","$state","$stateParams","Auth",function(a,b,c,d,e){a.$state=c,a.$stateParams=d,a.$on("$stateChangeStart",function(a,d,f,g,h){var i=e.getUser();i&&Date.create(1e3*i.exp).isPast()&&(a.preventDefault(),e.logout(),c.go("access.login")),"access.login"==d.name&&e.isAuthenticated()&&b.path("/dashboard"),e.authorize(d.role.access)||(a.preventDefault(),c.go("access.login"))})}]).constant("JQ_CONFIG",{easyPieChart:["assets/vendor/lazyload/jquery/charts/easypiechart/jquery.easy-pie-chart.js"],sparkline:["assets/vendor/lazyload/jquery/charts/sparkline/jquery.sparkline.min.js"],plot:["assets/vendor/lazyload/jquery/charts/flot/jquery.flot.min.js","assets/vendor/lazyload/jquery/charts/flot/jquery.flot.resize.js","assets/vendor/lazyload/jquery/charts/flot/jquery.flot.tooltip.min.js","assets/vendor/lazyload/jquery/charts/flot/jquery.flot.spline.js","assets/vendor/lazyload/jquery/charts/flot/jquery.flot.orderBars.js","assets/vendor/lazyload/jquery/charts/flot/jquery.flot.pie.min.js"],slimScroll:["assets/vendor/lazyload/jquery/slimscroll/jquery.slimscroll.min.js"],sortable:["assets/vendor/lazyload/jquery/sortable/jquery.sortable.js"],nestable:["assets/vendor/lazyload/jquery/nestable/jquery.nestable.js","assets/vendor/lazyload/jquery/nestable/nestable.css"],filestyle:["assets/vendor/lazyload/jquery/file/bootstrap-filestyle.min.js"],slider:["assets/vendor/lazyload/jquery/slider/bootstrap-slider.js","assets/vendor/lazyload/jquery/slider/slider.css"],chosen:["assets/vendor/lazyload/jquery/chosen/chosen.jquery.min.js","assets/vendor/lazyload/jquery/chosen/chosen.css"],TouchSpin:["assets/vendor/lazyload/jquery/spinner/jquery.bootstrap-touchspin.min.js","assets/vendor/lazyload/jquery/spinner/jquery.bootstrap-touchspin.css"],wysiwyg:["assets/vendor/lazyload/jquery/wysiwyg/bootstrap-wysiwyg.js","assets/vendor/lazyload/jquery/wysiwyg/jquery.hotkeys.js"],dataTable:["assets/vendor/lazyload/jquery/datatables/jquery.dataTables.min.js","assets/vendor/lazyload/jquery/datatables/dataTables.bootstrap.js","assets/vendor/lazyload/jquery/datatables/dataTables.bootstrap.css"],vectorMap:["assets/vendor/lazyload/jquery/jvectormap/jquery-jvectormap.min.js","assets/vendor/lazyload/jquery/jvectormap/jquery-jvectormap-world-mill-en.js","assets/vendor/lazyload/jquery/jvectormap/jquery-jvectormap-us-aea-en.js","assets/vendor/lazyload/jquery/jvectormap/jquery-jvectormap.css"],footable:["assets/vendor/lazyload/jquery/footable/footable.all.min.js","assets/vendor/lazyload/jquery/footable/footable.core.css"]}).factory("API",["Restangular",function(a){return a.withConfig(function(a){a.setBaseUrl(settings.baseApiUrl)})}]).config(["$ocLazyLoadProvider","$urlRouterProvider","$httpProvider","RestangularProvider",function(a,b,c,d){c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"],d.addResponseInterceptor(function(a,b,c,d,e,f){if(a.response&&a.response.data){var g=a.response.data;return a.response.meta&&(g.meta=a.response.meta),g}return a}),b.otherwise("/dashboard"),a.config({debug:!0,events:!0,modules:[{name:"ngGrid",files:["assets/vendor/lazyload/modules/ng-grid/ng-grid.min.js","assets/vendor/lazyload/modules/ng-grid/ng-grid.min.css","assets/vendor/lazyload/modules/ng-grid/theme.css"]},{name:"ui.grid",files:["assets/vendor/lazyload/modules/angular-ui-grid/ui-grid.min.js","assets/vendor/lazyload/modules/angular-ui-grid/ui-grid.min.css"]},{name:"ui.select",files:["assets/vendor/lazyload/modules/angular-ui-select/select.min.js","assets/vendor/lazyload/modules/angular-ui-select/select.min.css"]},{name:"angularFileUpload",files:["assets/vendor/lazyload/modules/angular-file-upload/angular-file-upload.min.js"]},{name:"ui.calendar",files:["assets/vendor/lazyload/modules/angular-ui-calendar/calendar.js"]},{name:"ngImgCrop",files:["assets/vendor/lazyload/modules/ngImgCrop/ng-img-crop.js","assets/vendor/lazyload/modules/ngImgCrop/ng-img-crop.css"]},{name:"angularBootstrapNavTree",files:["assets/vendor/lazyload/modules/angular-bootstrap-nav-tree/abn_tree_directive.js","assets/vendor/lazyload/modules/angular-bootstrap-nav-tree/abn_tree.css"]},{name:"toaster",files:["assets/vendor/lazyload/modules/angularjs-toaster/toaster.js","assets/vendor/lazyload/modules/angularjs-toaster/toaster.css"]},{name:"textAngular",files:["assets/vendor/lazyload/modules/textAngular/textAngular-sanitize.min.js","assets/vendor/lazyload/modules/textAngular/textAngular.min.js"]},{name:"vr.directives.slider",files:["assets/vendor/lazyload/modules/angular-slider/angular-slider.min.js","assets/vendor/lazyload/modules/angular-slider/angular-slider.css"]},{name:"com.2fdevs.videogular",files:["assets/vendor/lazyload/modules/videogular/videogular.min.js"]},{name:"com.2fdevs.videogular.plugins.controls",files:["assets/vendor/lazyload/modules/videogular/plugins/controls.min.js"]},{name:"com.2fdevs.videogular.plugins.buffering",files:["assets/vendor/lazyload/modules/videogular/plugins/buffering.min.js"]},{name:"com.2fdevs.videogular.plugins.overlayplay",files:["assets/vendor/lazyload/modules/videogular/plugins/overlay-play.min.js"]},{name:"com.2fdevs.videogular.plugins.poster",files:["assets/vendor/lazyload/modules/videogular/plugins/poster.min.js"]},{name:"com.2fdevs.videogular.plugins.imaads",files:["assets/vendor/lazyload/modules/videogular/plugins/ima-ads.min.js"]},{name:"xeditable",files:["assets/vendor/lazyload/modules/angular-xeditable/js/xeditable.min.js","assets/vendor/lazyload/modules/angular-xeditable/css/xeditable.css"]}]})}]),angular.module("ui.gravatar").config(["gravatarServiceProvider",function(a){a.defaults={size:100,default:"mm"}}]),angular.module("app").directive("setNgAnimate",["$animate",function(a){return{link:function(b,c,d){b.$watch(function(){return b.$eval(d.setNgAnimate,b)},function(b,d){a.enabled(!!b,c)})}}}]),angular.module("app").directive("uiButterbar",["$rootScope","$anchorScroll",function(a,b){return{restrict:"AC",template:'<span class="bar"></span>',link:function(a,c,d){c.addClass("butterbar hide"),a.$on("$stateChangeStart",function(a){b(),c.removeClass("hide").addClass("active")}),a.$on("$stateChangeSuccess",function(a,b,d,e){a.targetScope.$watch("$viewContentLoaded",function(){c.addClass("hide").removeClass("active")})})}}}]),angular.module("app").directive("uiFocus",function(a,b){return{link:function(c,d,e){var f=b(e.uiFocus);c.$watch(f,function(b){!0===b&&a(function(){d[0].focus()})}),d.bind("blur",function(){c.$apply(f.assign(c,!1))})}}}),angular.module("app").directive("uiFullscreen",["uiLoad","$document","$window",function(a,b,c){return{restrict:"AC",template:'<i class="fa fa-expand fa-fw text"></i><i class="fa fa-compress fa-fw text-active"></i>',link:function(c,d,e){d.addClass("hide"),a.load("assets/vendor/lazyload/screenfull.min.js").then(function(){screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./)&&d.removeClass("hide"),d.on("click",function(){var a;e.target&&(a=$(e.target)[0]),screenfull.toggle(a)}),b.on(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?d.addClass("active"):d.removeClass("active")})})}}}]),angular.module("ui.jq",["ui.load"]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","JQ_CONFIG","uiLoad","$timeout",function(a,b,c,d){return{restrict:"A",compile:function(e,f){if(!angular.isFunction(e[f.uiJq])&&!b[f.uiJq])throw new Error('ui-jq: The "'+f.uiJq+'" function does not exist');var g=a&&a[f.uiJq];return function(a,e,f){function h(){var b=[];return f.uiOptions?(b=a.$eval("["+f.uiOptions+"]"),angular.isObject(g)&&angular.isObject(b[0])&&(b[0]=angular.extend({},g,b[0]))):g&&(b=[g]),b}function i(){d(function(){e[f.uiJq].apply(e,h())},0,!1)}function j(){f.uiRefresh&&a.$watch(f.uiRefresh,function(){i()})}f.ngModel&&e.is("select,input,textarea")&&e.bind("change",function(){e.trigger("input")}),b[f.uiJq]?c.load(b[f.uiJq]).then(function(){i(),j()}).catch(function(){}):(i(),j())}}}}]),function(){function a(a,b,c,d){angular.forEach(b.split(" "),function(b){window.google.maps.event.addListener(c,b,function(c){d.triggerHandler("map-"+b,c),a.$$phase||a.$apply()})})}function b(b,d){c.directive(b,[function(){return{restrict:"A",link:function(c,e,f){c.$watch(f[b],function(b){b&&a(c,d,b,e)})}}}])}var c=angular.module("ui.googlemap",[]);c.value("uiMapConfig",{}),c.directive("uiMap",["uiMapConfig","$parse",function(b,c){var d=b||{};return{restrict:"A",link:function(b,e,f){var g=angular.extend({},d,b.$eval(f.uiOptions)),h=new window.google.maps.Map(e[0],g);c(f.uiMap).assign(b,h),a(b,"bounds_changed center_changed click dblclick drag dragend dragstart heading_changed idle maptypeid_changed mousemove mouseout mouseover projection_changed resize rightclick tilesloaded tilt_changed zoom_changed",h,e)}}}]),c.value("uiMapInfoWindowConfig",{}),c.directive("uiMapInfoWindow",["uiMapInfoWindowConfig","$parse","$compile",function(b,c,d){var e=b||{};return{link:function(b,f,g){var h=angular.extend({},e,b.$eval(g.uiOptions));h.content=f[0];var i=c(g.uiMapInfoWindow),j=i(b);j||(j=new window.google.maps.InfoWindow(h),i.assign(b,j)),a(b,"closeclick content_change domready position_changed zindex_changed",j,f),f.replaceWith("<div></div>");var k=j.open;j.open=function(a,c,e,g,h,i){d(f.contents())(b),k.call(j,a,c,e,g,h,i)}}}}]),b("uiMapMarker","animation_changed click clickable_changed cursor_changed dblclick drag dragend draggable_changed dragstart flat_changed icon_changed mousedown mouseout mouseover mouseup position_changed rightclick shadow_changed shape_changed title_changed visible_changed zindex_changed"),b("uiMapPolyline","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapPolygon","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapRectangle","bounds_changed click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapCircle","center_changed click dblclick mousedown mousemove mouseout mouseover mouseup radius_changed rightclick"),b("uiMapGroundOverlay","click dblclick")}(),angular.module("app").directive("uiModule",["MODULE_CONFIG","uiLoad","$compile",function(a,b,c){return{restrict:"A",compile:function(d,e){var f=d.contents().clone();return function(d,e,g){e.contents().remove(),b.load(a[g.uiModule]).then(function(){c(f)(d,function(a,b){e.append(a)})})}}}}]),angular.module("app").directive("uiNav",["$timeout",function(a){return{restrict:"AC",link:function(a,b,c){var d,e=$(window),f=768,g=$(".app-aside");b.on("click","a",function(a){d&&d.trigger("mouseleave.nav");var b=$(this);b.parent().siblings(".active").toggleClass("active"),b.next().is("ul")&&b.parent().toggleClass("active")&&a.preventDefault(),b.next().is("ul")||e.width()<f&&$(".app-aside").removeClass("show off-screen")}),b.on("mouseenter","a",function(a){if(d&&d.trigger("mouseleave.nav"),$("> .nav",g).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||e.width()<f||$(".app-aside-dock").length)){var b,c=$(a.target),h=$(window).height(),i=50;!c.is("a")&&(c=c.closest("a")),c.next().is("ul")&&(d=c.next(),c.parent().addClass("active"),b=c.parent().position().top+i,d.css("top",b),b+d.height()>h&&d.css("bottom",0),b+150>h&&d.css("bottom",h-b-i).css("top","auto"),d.appendTo(g),d.on("mouseleave.nav",function(a){$(".dropdown-backdrop").remove(),d.appendTo(c.parent()),d.off("mouseleave.nav").css("top","auto").css("bottom","auto"),c.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(a){a&&a.trigger("mouseleave.nav")}))}}),g.on("mouseleave",function(a){d&&d.trigger("mouseleave.nav"),$("> .nav",g).remove()})}}}]),angular.module("app").directive("uiScroll",["$location","$anchorScroll",function(a,b){return{restrict:"AC",link:function(c,d,e){d.on("click",function(c){a.hash(e.uiScroll),b()})}}}]),angular.module("app").directive("uiShift",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){function e(){a(function(){var a=d.uiShift,b=d.target;h.hasClass("in")||h[a](b).addClass("in")})}function f(){g&&g.prepend(c),!g&&h.insertAfter(j),h.removeClass("in")}var g,h=$(c),i=$(window),j=h.prev(),k=i.width();!j.length&&(g=h.parent()),k<768&&e()||f(),i.resize(function(){k!==i.width()&&a(function(){i.width()<768&&e()||f(),k=i.width()})})}}}]),angular.module("app").directive("uiToggleClass",["$timeout","$document",function(a,b){return{restrict:"AC",link:function(a,b,c){b.on("click",function(a){function d(a,b){for(var c=new RegExp("\\s"+a.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),d=" "+$(b)[0].className+" ";c.test(d);)d=d.replace(c," ");$(b)[0].className=$.trim(d)}a.preventDefault();var e=c.uiToggleClass.split(","),f=c.target&&c.target.split(",")||Array(b),g=0;angular.forEach(e,function(a){var b=f[f.length&&g];-1!==a.indexOf("*")&&d(a,b),$(b).toggleClass(a),g++}),$(b).toggleClass("active")})}}}]),angular.module("app").run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]).controller("AppCtrl",["$scope","$localStorage","$window","Auth","$state",function(a,b,c,d,e){function f(a){return/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(a.navigator.userAgent||a.navigator.vendor||a.opera)}!!navigator.userAgent.match(/MSIE/i)&&angular.element(c.document.body).addClass("ie"),f(c)&&angular.element(c.document.body).addClass("smart"),a.app={name:"Pulsera Admin",version:"1.0.0",settings:{themeID:1,navbarHeaderColor:"bg-black",navbarCollapseColor:"bg-white-only",asideColor:"bg-black",headerFixed:!0,asideFixed:!1,asideFolded:!1,asideDock:!1,container:!1}},a.user=d.getUser(),a.$on("fetchUserData",function(b,c){a.user=d.getUser()}),angular.isDefined(b.settings)?a.app.settings=b.settings:b.settings=a.app.settings,a.$watch("app.settings",function(){a.app.settings.asideDock&&a.app.settings.asideFixed&&(a.app.settings.headerFixed=!0),b.settings=a.app.settings},!0),a.logout=function(){d.logout(),e.go("access.login")}}]),angular.module("app.accessService",[]).constant("AccessLevel",{anon:0,user:1,admin:2}),angular.module("app.authService",[]).factory("Auth",["$http","LocalService","API","$q","AccessLevel",function(a,b,c,d,e){return{authorize:function(a){return a!==e.user||this.isAuthenticated()},isAuthenticated:function(){return b.get("auth_token")},login:function(a){var e=d.defer();return c.all("login").post(a).then(function(a){b.set("auth_token",JSON.stringify(a)),e.resolve(a)},function(a){e.reject(a)}),e.promise},logout:function(){b.unset("auth_token")},getUser:function(){return!!b.get("auth_token")&&angular.fromJson(b.get("auth_token")).user}}}]).factory("AuthInterceptor",["$q","$injector","LocalService",function(a,b,c){return{request:function(a){var b;return c.get("auth_token")&&(b=angular.fromJson(c.get("auth_token")).token),b&&(a.headers.Authorization="Bearer "+b),a},responseError:function(d){return 401!==d.status&&403!==d.status||(c.unset("auth_token"),b.get("$state").go("access.login")),a.reject(d)}}}]).config(["$httpProvider",function(a){a.interceptors.push("AuthInterceptor")}]),angular.module("app.localService",[]).factory("LocalService",function(){return{get:function(a){return localStorage.getItem(a)},set:function(a,b){return localStorage.setItem(a,b)},unset:function(a){return localStorage.removeItem(a)}}}),angular.module("ui.load",[]).service("uiLoad",["$document","$q","$timeout",function(a,b,c){var d=[],e=!1,f=b.defer();this.load=function(a){a=angular.isArray(a)?a:a.split(/\s+/);var b=this;return e||(e=f.promise),angular.forEach(a,function(a){e=e.then(function(){return a.indexOf(".css")>=0?b.loadCSS(a):b.loadScript(a)})}),f.resolve(),e},this.loadScript=function(e){if(d[e])return d[e].promise;var f=b.defer(),g=a[0].createElement("script");return g.src=e,g.onload=function(a){c(function(){f.resolve(a)})},g.onerror=function(a){c(function(){f.reject(a)})},a[0].body.appendChild(g),d[e]=f,f.promise},this.loadCSS=function(e){if(d[e])return d[e].promise;var f=b.defer(),g=a[0].createElement("link");return g.rel="stylesheet",g.type="text/css",g.href=e,g.onload=function(a){c(function(){f.resolve(a)})},g.onerror=function(a){c(function(){f.reject(a)})},a[0].head.appendChild(g),d[e]=f,f.promise}}]),angular.module("app.utilities",[]).factory("UtilService",function(){function a(a){var b,c,d={};switch(a){case"six-month":b=new Date,b.setMonth(b.getMonth()-6),c=new Date;break;case"three-month":b=new Date,b.setMonth(b.getMonth()-3),c=new Date;break;case"today":b=new Date,b.setHours(0),b.setMinutes(0),b.setSeconds(0),c=new Date;break;case"month":b=new Date,b.setMonth(b.getMonth()-1),c=new Date;break;case"week":b=new Date,b.setDate(b.getDate()-7),c=new Date;break;default:b=new Date(0),c=new Date}return d.from=b,d.to=c,d}return{computePeriod:a}}),angular.module("app.access",["ui.router"]).config(["$stateProvider","AccessLevel",function(a,b){a.state("access",{url:"/access",template:'<div ui-view class="fade-in-up smooth"></div>',role:{access:b.anon}}).state("access.login",{url:"/login",templateUrl:"modules/access/login.html",role:{access:b.anon}}).state("access.forgot_password",{url:"/forgot",templateUrl:"modules/access/forgot_password.html",role:{access:b.anon}})}]).controller("LoginCtrl",["$scope","$state","Auth",function(a,b,c){a.credentials={},a.alert=null,a.login=function(){a.closeAlert(),a.logging=!0,c.login(a.credentials).then(function(c){a.logging=!1,a.$emit("fetchUserData","true"),b.go("dashboard.home")},function(b){a.logging=!1,a.alert={type:"danger",message:b.data.response.message}})},a.closeAlert=function(){a.alert=null}}]).controller("ForgotPasswordCtrl",["$scope","$http","$state","API",function(a,b,c,d){a.alert=null,a.userData={},a.sendPasswordLink=function(){a.closeAlert(),a.isCollapsed=!0,a.disabled=!0,a.buttonText="Sending Mail...",d.all("reset_link").post({username:a.username}).then(function(b){a.disabled=!1,a.isCollapsed=!1,a.userData=b,a.buttonText="Reset Password",a.username=""},function(b){a.disabled=!1,a.buttonText="Reset Password",a.alert={type:"danger",message:b.data.response.message}})},a.closeAlert=function(){a.alert=null}}]),angular.module("app.dashboard",["ui.router"]).config(["$stateProvider","AccessLevel",function(a,b){a.state("dashboard",{abstract:!0,url:"/dashboard",templateUrl:"components/layouts/default.html",role:{access:b.user}}).state("dashboard.home",{url:"",templateUrl:"modules/dashboard/index.html",role:{access:b.user}})}]).controller("DashboardCtrl",["$scope","$state","API","Auth","$modal","UtilService",function(a,b,c,d,e,f){function g(a){this.name=a.school.name.replace(/\\/g,""),this.buyer=a.buyer.contactName,this.createdAt=a.createdAt,this.id=a.id}function h(){a.loading=!0,a.ordersList=[],c.all("orders").getList(a.params).then(function(b){a.loading=!1,a.meta=b.meta,a.ordersList=b.map(function(a){if(a.buyer)return new g(a)})})}a.notFound=!0,a.sortType="name",a.sortReverse=!1,a.search="",a.filterByTime="today",a.ordersList=[],a.loading=!0,a.$watch("filterByTime",function(b){a.params=f.computePeriod(b),a.params.isShipped=!1,h()}),a.pageChanged=function(){a.params.page=a.meta.page,h()}}]),angular.module("app.school",["ui.router"]).config(["$stateProvider","AccessLevel",function(a,b){a.state("school",{abstract:!0,url:"/schools",templateUrl:"components/layouts/default.html",role:{access:b.user}}).state("school.home",{url:"",templateUrl:"modules/school/index.html",controller:"SchoolCtrl",role:{access:b.user}}).state("school.view",{url:"/:id",templateUrl:"modules/school/view.html",controller:"SchoolViewCtrl",role:{access:b.user},resolve:{school:["API","$stateParams",function(a,b){return a.one("school",b.id).get()}]}})}]).controller("SchoolCtrl",["$scope","$state","API","Auth","$modal",function(a,b,c,d,e){function f(){a.loading=!0,a.schools=[],c.all("schools").getList(a.params).then(function(b){a.loading=!1,a.meta=b.meta,a.schools=b.map(function(a){return a.name=a.name.replace(/\\/g,""),a.ordersLength=a.orders.length,a.location=a.city+", "+a.state,a})})}a.sortType="name",a.sortReverse=!1,a.search="",a.params={limit:100},f(),a.pageChanged=function(){a.params.page=a.meta.page,f()},a.$watch("search",function(b){a.params.search=a.search,f()})}]).controller("SchoolViewCtrl",["$scope","$state","API","Auth","$modal","$stateParams","toaster","school",function(a,b,c,d,e,f,g,h){h.name=h.name.replace(/\\/gi,""),a.model=h,a.model.processed=h.orders.filter(function(a){return!0===a.isShipped}),a.model.unprocessed=h.orders.filter(function(a){return!1===a.isShipped}),a.selected={allSelection:!1,list:[]},a.sortType="-updatedAt",a.sortReverse=!1,a.search="",a.shipping=!1,a.ship=function(){a.shipping=!0,c.all("ship/order").post({ids:a.selected.list}).then(function(c){a.shipping=!1;var d={type:"success",title:"Success",text:"Shipments Shipped Successfully"};g.pop(d.type,d.title,d.text),b.reload()},function(b){if(a.shipping=!1,b.data){var c={type:"error",title:b.data.response.message,message:b.data.response.data[0].ShipmentConfirmResponse.Response[0].Error[0].ErrorDescription[0]};g.pop(c.type,c.title,c.message)}else{var c={type:"error",title:"Error Occurred, Please Try Again",message:"Please Try Again Later"};g.pop(c.type,c.title,c.message)}})},a.toggleSelection=function(){a.selected.allSelection?a.selected.list=a.model.unprocessed.map(function(a){return a.id}):a.selected.list=[]}}]),angular.module("app.shipment",["ui.router"]).config(["$stateProvider","AccessLevel",function(a,b){a.state("shipment",{abstract:!0,url:"/shipment",templateUrl:"components/layouts/default.html",role:{access:b.user}}).state("shipment.processed",{url:"/processed",controller:"ShipmentCtrl",templateUrl:"modules/shipment/processed.html",role:{access:b.user}}).state("shipment.unprocessed",{url:"/unprocessed",controller:"unShipmentCtrl",templateUrl:"modules/shipment/unprocessed.html",role:{access:b.user}}).state("shipment.view",{url:"/:id",controller:"OrderViewCtrl",templateUrl:"modules/shipment/view.html",role:{access:b.user}})}]).controller("unShipmentCtrl",["$scope","$state","API","Auth","$modal","toaster","UtilService",function(a,b,c,d,e,f,g){function h(a){this.name=a.school.name.replace(/\\/g,""),this.buyer=a.buyer.contactName,this.createdAt=a.createdAt,this.id=a.id}function i(a){this.name=a.school[0].name.replace(/\\/g,""),this.buyer=a.buyer[0].contactName,this.createdAt=a.createdAt,this.id=a._id}function j(){a.loading=!0,a.params.search=a.search,a.ordersList=[],c.all("orders").getList(a.params).then(function(b){a.loading=!1,a.meta=b.meta,a.ordersList=b.map(function(b){if(b.buyer)return a.search?new i(b):new h(b)})})}d.getUser();a.selected={list:[],allSelection:!1},a.notFound=!0,a.filterByTime="month",a.sortType="createdAt",a.sortReverse=!0,a.search="",a.ordersList=[],a.loading=!0,a.$watch("filterByTime",function(b){a.params=g.computePeriod(b),a.params.isShipped=!1,j()}),a.$watch("search",function(a){j()}),a.pageChanged=function(){a.params.page=a.meta.page,j()},a.shipping=!1,a.ship=function(){a.shipping=!0,c.all("ship/order").post({ids:a.selected.list}).then(function(c){a.shipping=!1;var d={type:"success",title:"Success",text:"Shipments Shipped Successfully"};f.pop(d.type,d.title,d.text),b.reload()},function(b){a.shipping=!1,b.data?(alert={type:"error",title:b.data.response.message,message:b.data.response.data[0].ShipmentConfirmResponse.Response[0].Error[0].ErrorDescription[0]},f.pop(alert.type,alert.title,alert.message)):(alert={type:"error",title:"Error Occurred, Please Try Again",message:"Please try again"},f.pop(alert.type,alert.title,alert.message))})},a.toggleSelection=function(){a.selected.allSelection?a.selected.list=a.ordersList.map(function(a){return a.id}):a.selected.list=[]}}]).controller("ShipmentCtrl",["$scope","$state","API","Auth","$modal","UtilService",function(a,b,c,d,e,f){function g(a){this.name=a.school.name.replace(/\\/g,""),this.buyer=a.buyer.contactName,this.updatedAt=a.updatedAt,this.id=a.id}function h(){a.loading=!0,a.ordersList=[],c.all("orders").getList(a.params).then(function(b){a.loading=!1,a.meta=b.meta,a.ordersList=b.map(function(a){if(a.buyer)return new g(a)})})}a.ordersList=[],a.sortType="updatedAt",a.sortReverse=!0,a.search="",a.filterByTime="month",a.$watch("filterByTime",function(b){a.params=f.computePeriod(b),a.params.isShipped=!0,h()}),a.pageChanged=function(){a.params.page=a.meta.page,h()}}]).controller("OrderViewCtrl",["$scope","$state","API","Auth","$modal","$stateParams","toaster","$http",function(a,b,c,d,e,f,g,h){var i;a.shipping=!1,c.one("order",f.id).get().then(function(b){i=angular.copy(b),a.model=b,c.one("buyer",b.buyer.id).get().then(function(b){a.buyer=b}),c.one("school",b.school.id).get().then(function(b){a.school=b})}),a.editMode=!1,a.toggleEdit=function(){a.editMode=!a.editMode,a.model=angular.copy(i)},a.save=function(){a.saving=!0,a.buyer.put().then(function(c){a.school.addressLine1=c.addressLine1,a.school.addressLine2=c.addressLine2,a.school.city=c.city,a.school.state=c.state,a.school.zipCode=c.zipCode,a.school.name=c.company,a.school.put().then(function(c){a.saving=!1;var d={type:"success",title:"Success",text:"Shipment Updated Successfully"};g.pop(d.type,d.title,d.text),b.reload()})})},a.print=function(d){a.printing=!0;var e;"shipment"===d?e=a.model.shipment.ShipmentResults[0].PackageResults[0].LabelImage[0].GraphicImage[0]:"return"===d?e=a.model.returnedShipment.ShipmentResults[0].PackageResults[0].LabelImage[0].GraphicImage[0]:"extra"===d&&(e=a.model.extraShipment.ShipmentResults[0].PackageResults[0].LabelImage[0].GraphicImage[0]),c.all("print").post({data:e}).then(function(c){a.printing=!1;var d={type:"success",title:"Success",text:"Label Sent To Printer Successfully"};g.pop(d.type,d.title,d.text),b.reload()},function(b){a.printing=!1;var c={type:"error",title:"Trouble connecting to the server",message:"Please try again later."};g.pop(c.type,c.title,c.message)})},a.ship=function(){a.shipping=!0,c.all("ship/order").post({ids:[a.model.id]}).then(function(c){a.shipping=!1;var d={type:"success",title:"Success",text:"Shipments Shipped Successfully"};g.pop(d.type,d.title,d.text),b.reload()},function(b){if(a.shipping=!1,b.data){var c={type:"error",title:b.data.response.message,message:b.data.response.data[0].ShipmentConfirmResponse.Response[0].Error[0].ErrorDescription[0]};g.pop(c.type,c.title,c.message)}else{var c={type:"error",title:"Trouble connecting to the server",message:"Error Occurred, Please Try Again"};g.pop(c.type,c.title,c.message)}})},a.extraShip=function(){a.shipping=!0,c.all("extra/ship").post({id:a.model.id}).then(function(c){a.shipping=!1;var d={type:"success",title:"Success",text:"Shipment Shipped Successfully"};g.pop(d.type,d.title,d.text),b.reload()},function(b){if(a.shipping=!1,b.data){var c={type:"error",title:b.data.response.message,message:b.data.response.data[0].ShipmentConfirmResponse.Response[0].Error[0].ErrorDescription[0]};g.pop(c.type,c.title,c.message)}else{var c={type:"error",title:"Error Occurred, Please Try Again",message:"Trouble connecting to the server"};g.pop(c.type,c.title,c.message)}})},a.giftShip=function(){a.gift_shipping=!0,c.all("gift/ship").post({id:a.model.id}).then(function(c){a.gift_shipping=!1;var d={type:"success",title:"Success",text:"Shipment Shipped Successfully"};g.pop(d.type,d.title,d.text),b.reload()},function(b){if(a.gift_shipping=!1,b.data){var c={type:"error",title:b.data.response.message,message:b.data.response.data[0].ShipmentConfirmResponse.Response[0].Error[0].ErrorDescription[0]};g.pop(c.type,c.title,c.message)}else{var c={type:"error",title:"Error Occurred, Please Try Again",message:"Trouble connecting to the server"};g.pop(c.type,c.title,c.message)}})}}]),angular.module("app.users",["ui.router"]).config(["$stateProvider","AccessLevel",function(a,b){a.state("user",{abstract:!0,url:"/user",templateUrl:"components/layouts/default.html"}).state("user.list",{url:"/all",templateUrl:"modules/user/list.html",role:{access:b.admin}}).state("user.create",{url:"/create",controller:"UserCreationController",templateUrl:"modules/user/create.html",role:{access:b.admin}})}]).controller("userCtrl",["$scope","$state","API","Auth","toaster",function(a,b,c,d,e){a.sortType="email",a.sortReverse=!1,a.search="",c.all("users").getList().then(function(b){a.users=b},function(b){a.error=b})}]).controller("UserCreationController",["$scope","$state","API","$stateParams","toaster",function(a,b,c,d,e){a.userslist={},a.userData={password:""},a.check=function(){""===a.userData.password&&""===a.confirmpassword?a.passwordsAlert={type:"danger",message:"Both Fields are empty"}:void 0===a.userData.password||void 0===a.confirmpassword?a.passwordsAlert={type:"danger",message:"Please Fill Password Field First"}:a.confirmpassword!==a.userData.password?a.passwordsAlert={type:"danger",message:"passwords not equal"}:a.passwordsAlert={type:"success",message:"passwords are now equal"}},a.create=function(){c.all("user").post(a.userData).then(function(a){var c={type:"success",title:"Success",text:"User Created Successfully"};e.pop(c.type,c.title,c.text),b.go("user.list")},function(a){var b={type:"error",title:"Error Occurred, Please Try Again",message:a.data.response.message};e.pop(b.type,b.title,b.message)})}}]);